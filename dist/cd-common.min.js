var gulp=require("gulp"),rename=require("gulp-rename"),autoprefixer=require("gulp-autoprefixer"),uglify=require("gulp-uglify"),semistandard=require("gulp-semistandard"),concat=require("gulp-concat"),less=require("gulp-less"),del=require("del");gulp.task("clean",function(){return del("./dist/")}),gulp.task("semistandard",function(){return gulp.src(["**/*.js","!node_modules/**/*","!dist/**/*"]).pipe(semistandard()).pipe(semistandard.reporter("default",{breakOnError:!0}))}),gulp.task("build-less",["clean"],function(){return gulp.src("cd-common.less").pipe(less({compress:!0})).pipe(autoprefixer()).pipe(rename("cd-common.min.css")).pipe(gulp.dest("./dist/"))}),gulp.task("copy-images",["clean"],function(){return gulp.src("coderdojo-logo-light-bg.svg").pipe(gulp.dest("./dist/"))}),gulp.task("build-js",["clean","semistandard"],function(){return gulp.src(["**/*.js","!node_modules/**/*","!dist/**/*"]).pipe(concat("cd-common.min.js")).pipe(uglify()).pipe(gulp.dest("./dist/"))}),gulp.task("build",["build-less","copy-images","build-js"]),gulp.task("watch",function(){gulp.watch("**/*.less",["build-less"]),gulp.watch("**/*.js",["build-js"])}),gulp.task("default",["build"]),window.cdMenu=function(){function e(e,t){return Array.prototype.forEach.call(e,t)}window.cdMenuConfig||(window.cdMenuConfig={});var t=window.cdMenuConfig.zenBase||"https://zen.coderdojo.com";t=t.replace(/\/$/,""),window.addEventListener("load",function(){function t(){u.setAttribute("data-toggle","closed"),r.className="cd-menu__scrim",e(o,function(e){e.setAttribute("data-toggle","closed")})}function n(){u.setAttribute("data-toggle","open"),r.className="cd-menu__scrim cd-menu__scrim--visible"}var i=document.querySelector(".cd-menu__hamburger"),u=document.querySelector("#cd-menu__slidingMenuPrimary"),r=document.querySelector(".cd-menu__scrim"),o=document.querySelectorAll(".cd-menu__slidingMenuSecondary"),c=document.querySelectorAll(".cd-menu__closeButton"),d=document.querySelectorAll(".cd-menu__slidingMenu .cd-menu__content > ul > li > span");i.addEventListener("click",function(){"open"===u.getAttribute("data-toggle")?t():n()}),r.addEventListener("click",t),e(c,function(e){e.addEventListener("click",t)}),e(d,function(e){var t=e.parentElement.querySelector(".cd-menu__slidingMenuSecondary"),n=t.querySelector(".cd-menu__backButton");n&&n.addEventListener("click",function(){t.setAttribute("data-toggle","closed")}),e&&e.addEventListener("click",function(){t.setAttribute("data-toggle","open")})})}),window.addEventListener("load",function(){function t(t){t.target!==n&&t.target.parentElement!==n&&n.setAttribute("data-toggle","closed"),e(i,function(e){t.target!==e&&t.target.parentElement!==e&&t.target.parentElement.parentElement!==e&&e.setAttribute("data-toggle","closed")})}var n=document.querySelector(".cd-menu__desktopNav .cd-menu__profile"),i=document.querySelectorAll(".cd-menu__dropdown");e(i,function(e){e.addEventListener("click",function(){"open"===this.getAttribute("data-toggle")?this.setAttribute("data-toggle","closed"):this.setAttribute("data-toggle","open")})}),document.getElementsByTagName("body")[0].addEventListener("click",t),document.getElementsByTagName("body")[0].addEventListener("touchstart",t)}),window.addEventListener("load",function(){function n(e,t,n,i){var u=new XMLHttpRequest;u.onreadystatechange=function(){if(4===this.readyState&&200===this.status)try{var e=JSON.parse(this.responseText);n(e)}catch(e){i(e)}else 4===this.readyState&&i(this)},u.open(t?"POST":"GET",e,!0),u.withCredentials=!0,t&&u.setRequestHeader("Content-type","application/json"),u.send(t)}function i(){e(r,function(e){e.style.display="block"})}var u=document.querySelectorAll(".cd-menu__cdfAdminLink"),r=document.querySelectorAll(".cd-menu__account"),o=document.querySelectorAll(".cd-menu__profile"),c=document.querySelectorAll(".cd-menu__profileName"),d=document.querySelectorAll(".cd-menu__profileLink"),l=document.querySelectorAll(".cd-menu__profilePic"),a=document.querySelector(".cd-menu__desktopNav .cd-menu__profile"),s=document.querySelectorAll(".cd-menu__refererLink");a.addEventListener("click",function(){"open"===this.getAttribute("data-toggle")?this.setAttribute("data-toggle","closed"):this.setAttribute("data-toggle","open")}),n(t+"/api/2.0/users/instance",null,function(r){r&&r.user?(e(c,function(e){e.innerText=r.user.name}),e(d,function(e){e.href=t+"/profile/"+r.user.id}),n(t+"/api/2.0/profiles/user-profile-data",JSON.stringify({query:{userId:r.user.id}}),function(c){n(t+"/api/2.0/profiles/"+c.id+"/avatar",null,function(t){t&&t.imageData&&t.imageInfo&&t.imageInfo.type?(e(l,function(e){e.src="data:"+t.imageInfo.type+";base64,"+t.imageData}),r.user.roles.indexOf("cdf-admin")!==-1&&e(u,function(e){e.style.display="block"}),e(o,function(e){e.style.display="block"}),e(s,function(e){e.addEventListener("click",function(e){e.preventDefault(),window.location.href=this.href+"?referer="+encodeURIComponent(window.location)})})):i()},i)},i)):i()},i)})};